var presideImageMapCreator=function(a){"use strict";function b(a,b,c){this.target=a,this.eventType=b,this.func=c,a.addEventListener(b,c,!1)}function c(a,b,e,f){this._el=document.createElementNS(d.SVG_NS,"rect"),this._el.classList.add(c.CLASS_NAME),this._el.setAttribute("height",c.SIZE),this._el.setAttribute("width",c.SIZE),this._el.setAttribute("x",b+c.OFFSET),this._el.setAttribute("y",e+c.OFFSET),a.appendChild(this._el),this._el.action=f,this._el.classList.add(c.ACTIONS_TO_CURSORS[f])}function d(a,b,c){if(this.constructor===d)throw new Error("This is abstract class");this._type=a,this._attributes={link:"",asset:"",page:"",alt:"",target:""},c&&this.setInfoAttributes(c),this._coords=b,this._groupEl=document.createElementNS(d.SVG_NS,"g"),i.addNodeToSvg(this._groupEl),this._groupEl.obj=this,this._el=null,this._helpers={},i.addObject(this)}function e(a,b){d.call(this,"rectangle",a,b),this._coords={x:a.x||0,y:a.y||0,width:a.width||0,height:a.height||0},this._el=document.createElementNS(d.SVG_NS,"rect"),this._groupEl.appendChild(this._el);var e=a.x-this._coords.width/2,f=a.y-this._coords.height/2;this._helpers={center:new c(this._groupEl,e,f,"move"),top:new c(this._groupEl,e,f,"editTop"),bottom:new c(this._groupEl,e,f,"editBottom"),left:new c(this._groupEl,e,f,"editLeft"),right:new c(this._groupEl,e,f,"editRight"),topLeft:new c(this._groupEl,e,f,"editTopLeft"),topRight:new c(this._groupEl,e,f,"editTopRight"),bottomLeft:new c(this._groupEl,e,f,"editBottomLeft"),bottomRight:new c(this._groupEl,e,f,"editBottomRight")},this.redraw()}function f(a,b){d.call(this,"circle",a,b),this._coords={cx:a.cx||0,cy:a.cy||0,radius:a.radius||0},this._el=document.createElementNS(d.SVG_NS,"circle"),this._groupEl.appendChild(this._el),this.helpers={center:new c(this._groupEl,a.cx,a.cy,"move"),top:new c(this._groupEl,a.cx,a.cy,"editTop"),bottom:new c(this._groupEl,a.cx,a.cy,"editBottom"),left:new c(this._groupEl,a.cx,a.cy,"editLeft"),right:new c(this._groupEl,a.cx,a.cy,"editRight")},this.redraw()}function g(a,b){d.call(this,"polygon",a,b),this._coords={points:a.points||[{x:0,y:0}],isOpened:a.isOpened||!1},this._el=document.createElementNS(d.SVG_NS,this._coords.isOpened?"polyline":"polygon"),this._groupEl.appendChild(this._el),this._helpers={points:[]};for(var e=0,f=this._coords.points.length;e<f;e++)this._helpers.points.push(new c(this._groupEl,this._coords.points[e].x,this._coords.points[e].y,"movePoint").setId(e));this._selectedPoint=-1,this.redraw()}var h={getOffset:function(a){var b=a.getBoundingClientRect();return{x:Math.round(b.left+window.pageXOffset),y:Math.round(b.top+window.pageYOffset)}},getRightCoords:function(a,b){return{x:a-i.getOffset("x"),y:b-i.getOffset("y")}},id:function(a){return document.getElementById(a)},hide:function(a){return a.style.display="none",this},show:function(a){return a.style.display="block",this},encode:function(a){return a.replace(/</g,"&lt;").replace(/>/g,"&gt;")},foreach:function(a,b){for(var c=0,d=a.length;c<d;c++)b(a[c],c)},foreachReverse:function(a,b){for(var c=a.length-1;c>=0;c--)b(a[c],c)},debug:function(){var a=document.getElementById("debug");return function(){a.innerHTML=[].join.call(arguments," ")}}(),stopEvent:function(a){return a.stopPropagation(),a.preventDefault(),this},extend:function(a,b){var c={};for(var d in a)a.hasOwnProperty(d)&&(c[d]=b[d]?b[d]:a[d]);return c},inherits:function(){var a=function(){};return function(b,c){a.prototype=c.prototype,b.prototype=new a,b.prototype.constructor=b}}()},i=function(){function c(){k.offset=h.getOffset(j.container)}function e(a){if("editing"===k.appMode)if("g"===a.target.parentNode.tagName){var b=a.target.parentNode.obj;if(i.deselectAll(),k.selectedArea=b,k.selectedArea.select(),k.selectedArea.editingStartPoint={x:a.pageX,y:a.pageY},a.target.classList.contains("helper")){var c=a.target;k.editType=c.action,c.n>=0&&(k.selectedArea.selected_point=c.n),i.addEvent(i.domElements.container,"mousemove",k.selectedArea.onProcessEditing.bind(k.selectedArea)).addEvent(i.domElements.container,"mouseup",k.selectedArea.onStopEditing.bind(k.selectedArea))}else"rect"!==a.target.tagName&&"circle"!==a.target.tagName&&"polygon"!==a.target.tagName||(k.editType="move",i.addEvent(i.domElements.container,"mousemove",k.selectedArea.onProcessEditing.bind(k.selectedArea)).addEvent(i.domElements.container,"mouseup",k.selectedArea.onStopEditing.bind(k.selectedArea)))}else i.deselectAll()}function f(a){"drawing"===k.appMode&&!k.isDraw&&k.currentType&&(i.setIsDraw(!0),c(),k.newArea=d.CONSTRUCTORS[k.currentType].createAndStartDrawing(h.getRightCoords(a.pageX,a.pageY)))}function g(a){"editing"===k.appMode&&("rect"!==a.target.tagName&&"circle"!==a.target.tagName&&"polygon"!==a.target.tagName||(k.selectedArea=a.target.parentNode.obj))}var j={svg:h.id("imageMapSvg"),img:h.id("imageMapImage"),container:h.id("imageMapContainer"),imageMapField:h.id("imagemap"),map:null},k={offset:{x:0,y:0},appMode:null,currentType:null,editType:null,newArea:null,selectedArea:null,loaded:!1,areas:[],events:[],isDraw:!1,image:{src:null,filename:null,width:0,height:0}};window.addEventListener("resize",c,!1),j.container.addEventListener("mousedown",function(a){a.preventDefault()},!1),j.img.addEventListener("dragstart",function(a){a.preventDefault()},!1),j.container.addEventListener("mousedown",e,!1),j.container.addEventListener("click",f,!1),j.container.addEventListener("dblclick",g,!1);var l={toJSON:function(){var a={areas:[],img:k.image.src};return h.foreach(k.areas,function(b){a.areas.push(b.toJSON())}),JSON.stringify(a)},fromJSON:function(a){var b=JSON.parse(a);h.foreach(b.areas,function(a){d.fromJSON(a)})}};return{domElements:j,update:function(){var a=l.toJSON();return j.imageMapField.value=k.areas.length?a:"",this},hide:function(){return h.hide(j.container),this},show:function(){return h.show(j.container),this},recalcOffsetValues:function(){return c(),this},setDimensions:function(a,b){return j.svg.setAttribute("width",a),j.svg.setAttribute("height",b),j.container.style.width=a+"px",j.container.style.height=b+"px",this},loadImage:function(b){return j.img.src=b,k.image.src=b,j.img.onload=function(){if(i.show().setDimensions(j.img.width,j.img.height).recalcOffsetValues().setMode("editing").setEditClass().deselectAll(),!k.loaded){var b=h.id("imagemap").value;b.length&&l.fromJSON(b),k.loaded=!0}a(".imageMapAddArea").removeAttr("disabled")},this},addNodeToSvg:function(a){return j.svg.appendChild(a),this},removeNodeFromSvg:function(a){return j.svg.removeChild(a),this},getOffset:function(a){switch(a){case"x":case"y":return k.offset[a]}},clear:function(){for(k.areas.length=0;j.svg.childNodes[0];)j.svg.removeChild(j.svg.childNodes[0]);return i.update(),i.disableRemoveButton(!0),this},removeObject:function(a){return null==a?this:(h.foreach(k.areas,function(b,c){b===a&&k.areas.splice(c,1)}),a.remove(),i.update(),i.disableRemoveButton(!0),this)},deselectAll:function(){return h.foreach(k.areas,function(a){a.deselect()}),k.selectedArea=null,a("#fieldset-imagemap_areas").hide(),i.disableRemoveButton(!0),this},disableRemoveButton:function(b){a("#imageMapRemoveArea").attr("disabled",b)},getIsDraw:function(){return k.isDraw},setIsDraw:function(a){return k.isDraw=a,this},setMode:function(b){return k.appMode=b,"drawing"!=b&&a(".imageMapAddArea").removeClass("active"),this},getMode:function(){return k.appMode},setShape:function(a){return k.currentType=a,this},getShape:function(){return k.currentType},addObject:function(a){return k.areas.push(a),this},getNewArea:function(){return k.newArea},resetNewArea:function(){return k.newArea=null,this},getSelectedArea:function(){return k.selectedArea},setSelectedArea:function(a){return k.selectedArea=a,this},getEditType:function(){return k.editType},setFilename:function(a){return k.image.filename=a,this},setEditClass:function(){return j.container.classList.remove("draw"),j.container.classList.add("edit"),this},setDrawClass:function(){return j.container.classList.remove("edit"),j.container.classList.add("draw"),this},addEvent:function(a,c,d){return k.events.push(new b(a,c,d)),this},removeAllEvents:function(){return h.foreach(k.events,function(a){a.remove()}),k.events.length=0,this}}}();b.prototype.remove=function(){this.target.removeEventListener(this.eventType,this.func,!1)},c.SIZE=5,c.OFFSET=-Math.ceil(c.SIZE/2),c.CLASS_NAME="helper",c.ACTIONS_TO_CURSORS={move:"move",editLeft:"w-resize",editRight:"e-resize",editTop:"n-resize",editBottom:"s-resize",editTopLeft:"nw-resize",editTopRight:"ne-resize",editBottomLeft:"sw-resize",editBottomRight:"se-resize",movePoint:"pointer"},c.prototype.setCoords=function(a,b){return this._el.setAttribute("x",a+c.OFFSET),this._el.setAttribute("y",b+c.OFFSET),this},c.prototype.setId=function(a){return this._el.n=a,this},d.SVG_NS="http://www.w3.org/2000/svg",d.CLASS_NAMES={SELECTED:"selected",WITH_HREF:"with_href"},d.CONSTRUCTORS={rectangle:e,circle:f,polygon:g},d.REGEXP={AREA:/<area(?=.*? shape="(rect|circle|poly)")(?=.*? coords="([\d ,]+?)")[\s\S]*?>/gim,HREF:/ href="([\S\s]+?)"/,ALT:/ alt="([\S\s]+?)"/,TITLE:/ title="([\S\s]+?)"/,DELIMETER:/ ?, ?/},d.HTML_NAMES_TO_AREA_NAMES={rect:"rectangle",circle:"circle",poly:"polygon"},d.prototype.ABSTRACT_METHOD=function(){throw new Error("This is abstract method")},d.prototype.setSVGCoords=d.prototype.setCoords=d.prototype.dynamicDraw=d.prototype.onProcessDrawing=d.prototype.onStopDrawing=d.prototype.edit=d.prototype.dynamicEdit=d.prototype.onProcessEditing=d.prototype.onStopEditing=d.prototype.toString=d.prototype.toHTMLMapElementString=d.prototype.getCoordsForDisplayingInfo=d.prototype.ABSTRACT_METHOD,d.prototype.redraw=function(a){return this.setSVGCoords(a||this._coords),this},d.prototype.remove=function(){i.removeNodeFromSvg(this._groupEl)},d.prototype.move=function(a,b){return this.setCoords(this.edit("move",a,b)).redraw(),this},d.prototype.select=function(){return this._el.classList.add(d.CLASS_NAMES.SELECTED),i.setSelectedArea(this),j.load(this),i.disableRemoveButton(!1),this},d.prototype.deselect=function(){return this._el.classList.remove(d.CLASS_NAMES.SELECTED),this},d.prototype.setInfoAttributes=function(a){this._attributes.link=a.link,this._attributes.asset=a.asset,this._attributes.page=a.page,this._attributes.alt=a.alt,this._attributes.target=a.target},d.prototype.toJSON=function(){return{type:this._type,coords:this._coords,attributes:this._attributes}},d.fromJSON=function(a){var b=d.CONSTRUCTORS[a.type];if(!b)throw new Error("This area type is not valid");if(!b.testCoords(a.coords))throw new Error("This coords is not valid for "+a.type);i.setIsDraw(!0);var c=new b(a.coords,a.attributes);return i.setIsDraw(!1).resetNewArea(),c},h.inherits(e,d),e.prototype.setSVGCoords=function(a){this._el.setAttribute("x",a.x),this._el.setAttribute("y",a.y),this._el.setAttribute("width",a.width),this._el.setAttribute("height",a.height);var b=a.y,c=a.y+a.height/2,d=a.y+a.height,e=a.x,f=a.x+a.width/2,g=a.x+a.width;return this._helpers.center.setCoords(f,c),this._helpers.top.setCoords(f,b),this._helpers.bottom.setCoords(f,d),this._helpers.left.setCoords(e,c),this._helpers.right.setCoords(g,c),this._helpers.topLeft.setCoords(e,b),this._helpers.topRight.setCoords(g,b),this._helpers.bottomLeft.setCoords(e,d),this._helpers.bottomRight.setCoords(g,d),this},e.prototype.setCoords=function(a){return this._coords.x=a.x,this._coords.y=a.y,this._coords.width=a.width,this._coords.height=a.height,this},e.prototype.dynamicDraw=function(a,b,c){var d={x:this._coords.x,y:this._coords.y,width:a-this._coords.x,height:b-this._coords.y};return c&&(d=e.getSquareCoords(d)),d=e.getNormalizedCoords(d),this.redraw(d),d},e.prototype.onProcessDrawing=function(a){var b=h.getRightCoords(a.pageX,a.pageY);this.dynamicDraw(b.x,b.y,a.shiftKey)},e.prototype.onStopDrawing=function(a){var b=h.getRightCoords(a.pageX,a.pageY);this.setCoords(this.dynamicDraw(b.x,b.y,a.shiftKey)).deselect(),i.removeAllEvents().setIsDraw(!1).resetNewArea().setMode("editing").setEditClass(),this.select()},e.prototype.edit=function(a,b,c){var d=Object.create(this._coords);switch(a){case"move":d.x+=b,d.y+=c;break;case"editLeft":d.x+=b,d.width-=b;break;case"editRight":d.width+=b;break;case"editTop":d.y+=c,d.height-=c;break;case"editBottom":d.height+=c;break;case"editTopLeft":d.x+=b,d.y+=c,d.width-=b,d.height-=c;break;case"editTopRight":d.y+=c,d.width+=b,d.height-=c;break;case"editBottomLeft":d.x+=b,d.width-=b,d.height+=c;break;case"editBottomRight":d.width+=b,d.height+=c}return d},e.prototype.dynamicEdit=function(a,b){return a=e.getNormalizedCoords(a),b&&(a=e.getSavedProportionsCoords(a)),this.redraw(a),a},e.prototype.onProcessEditing=function(a){return this.dynamicEdit(this.edit(i.getEditType(),a.pageX-this.editingStartPoint.x,a.pageY-this.editingStartPoint.y),a.shiftKey)},e.prototype.onStopEditing=function(a){this.setCoords(this.onProcessEditing(a)),i.removeAllEvents(),i.update()},e.prototype.toString=function(){return"Rectangle {x: "+this._coords.x+", y: "+this._coords.y+", width: "+this._coords.width+", height: "+this._coords.height+"}"},e.prototype.toHTMLMapElementString=function(){var a=this._coords.x+this._coords.width,b=this._coords.y+this._coords.height;return'<area shape="rect" coords="'+this._coords.x+", "+this._coords.y+", "+a+", "+b+'"'+(this._attributes.href?' href="'+this._attributes.href+'"':"")+(this._attributes.alt?' alt="'+this._attributes.alt+'"':"")+(this._attributes.title?' title="'+this._attributes.title+'"':"")+" />"},e.prototype.getCoordsForDisplayingInfo=function(){return{x:this._coords.x,y:this._coords.y}},e.testCoords=function(a){return a.x&&a.y&&a.width&&a.height},e.testHTMLCoords=function(a){return 4===a.length},e.getCoordsFromHTMLArray=function(a){if(!e.testHTMLCoords(a))throw new Error("This html-coordinates is not valid for rectangle");return{x:a[0],y:a[1],width:a[2]-a[0],height:a[3]-a[1]}},e.getNormalizedCoords=function(a){return a.width<0&&(a.x+=a.width,a.width=Math.abs(a.width)),a.height<0&&(a.y+=a.height,a.height=Math.abs(a.height)),a},e.getSquareCoords=function(a){var b=Math.abs(a.width),c=Math.abs(a.height);return b>c?a.width=a.width>0?c:-c:a.height=a.height>0?b:-b,a},e.getSavedProportionsCoords=function(a,b){var c=a.width/a.height;return b.width/b.height>c?a.width=Math.round(a.height*c):a.height=Math.round(a.width/c),a},e.createAndStartDrawing=function(a){var b=new e({x:a.x,y:a.y,width:0,height:0});return i.addEvent(i.domElements.container,"mousemove",b.onProcessDrawing.bind(b)).addEvent(i.domElements.container,"click",b.onStopDrawing.bind(b)),b},h.inherits(f,d),f.prototype.setSVGCoords=function(a){return this._el.setAttribute("cx",a.cx),this._el.setAttribute("cy",a.cy),this._el.setAttribute("r",a.radius),this.helpers.center.setCoords(a.cx,a.cy),this.helpers.top.setCoords(a.cx,a.cy-a.radius),this.helpers.right.setCoords(a.cx+a.radius,a.cy),this.helpers.bottom.setCoords(a.cx,a.cy+a.radius),this.helpers.left.setCoords(a.cx-a.radius,a.cy),this},f.prototype.setCoords=function(a){return this._coords.cx=a.cx,this._coords.cy=a.cy,this._coords.radius=a.radius,this},f.prototype.dynamicDraw=function(a,b){var c=Math.round(Math.sqrt(Math.pow(this._coords.cx-a,2)+Math.pow(this._coords.cy-b,2))),d={cx:this._coords.cx,cy:this._coords.cy,radius:c};return this.redraw(d),d},f.prototype.onProcessDrawing=function(a){var b=h.getRightCoords(a.pageX,a.pageY);this.dynamicDraw(b.x,b.y)},f.prototype.onStopDrawing=function(a){var b=h.getRightCoords(a.pageX,a.pageY);this.setCoords(this.dynamicDraw(b.x,b.y)).deselect(),i.removeAllEvents().setIsDraw(!1).resetNewArea().setMode("editing").setEditClass(),this.select()},f.prototype.edit=function(a,b,c){var d=Object.create(this._coords);switch(a){case"move":d.cx+=b,d.cy+=c;break;case"editTop":d.radius-=c;break;case"editBottom":d.radius+=c;break;case"editLeft":d.radius-=b;break;case"editRight":d.radius+=b}return d},f.prototype.dynamicEdit=function(a){return a.radius<0&&(a.radius=Math.abs(a.radius)),this.setSVGCoords(a),a},f.prototype.onProcessEditing=function(a){var b=i.getEditType();return this.dynamicEdit(this.edit(b,a.pageX-this.editingStartPoint.x,a.pageY-this.editingStartPoint.y))},f.prototype.onStopEditing=function(a){i.getEditType();this.setCoords(this.onProcessEditing(a)),i.removeAllEvents(),i.update()},f.prototype.toString=function(){return"Circle {cx: "+this._coords.cx+", cy: "+this._coords.cy+", radius: "+this._coords.radius+"}"},f.prototype.toHTMLMapElementString=function(){return'<area shape="circle" coords="'+this._coords.cx+", "+this._coords.cy+", "+this._coords.radius+'"'+(this._attributes.href?' href="'+this._attributes.href+'"':"")+(this._attributes.alt?' alt="'+this._attributes.alt+'"':"")+(this._attributes.title?' title="'+this._attributes.title+'"':"")+" />"},f.prototype.getCoordsForDisplayingInfo=function(){return{x:this._coords.cx,y:this._coords.cy}},f.testCoords=function(a){return a.cx&&a.cy&&a.radius},f.testHTMLCoords=function(a){return 3===a.length},f.getCoordsFromHTMLArray=function(a){if(!f.testHTMLCoords(a))throw new Error("This html-coordinates is not valid for circle");return{cx:a[0],cy:a[1],radius:a[2]}},f.createAndStartDrawing=function(a){var b=new f({cx:a.x,cy:a.y,radius:0});return i.addEvent(i.domElements.container,"mousemove",b.onProcessDrawing.bind(b)).addEvent(i.domElements.container,"click",b.onStopDrawing.bind(b)),b},h.inherits(g,d),g.prototype.close=function(){var a=this._el;this._el=document.createElementNS(d.SVG_NS,"polygon"),this._groupEl.replaceChild(this._el,a),this._coords.isOpened=!1,this.redraw().deselect()},g.prototype.setSVGCoords=function(a){var b=a.points.reduce(function(a,b){return a+b.x+" "+b.y+" "},"");return this._el.setAttribute("points",b),h.foreach(this._helpers.points,function(b,c){b.setCoords(a.points[c].x,a.points[c].y)}),this},g.prototype.setCoords=function(a){return this._coords.points=a.points,this},g.prototype.addPoint=function(a,b){if(!this._coords.isOpened)throw new Error("This polygon is closed!");var d=new c(this._groupEl,a,b,"movePoint");return d.setId(this._helpers.points.length),this._helpers.points.push(d),this._coords.points.push({x:a,y:b}),this.redraw(),this},g.prototype.dynamicDraw=function(a,b,c){var d={points:[].concat(this._coords.points)};if(c){var e=g.getRightAngleLineLastPointCoords(this._coords,{x:a,y:b});a=e.x,b=e.y}return d.points.push({x:a,y:b}),this.redraw(d),d},g.prototype.onProcessDrawing=function(a){var b=h.getRightCoords(a.pageX,a.pageY);this.dynamicDraw(b.x,b.y,a.shiftKey)},g.prototype.onAddPointDrawing=function(a){var b=h.getRightCoords(a.pageX,a.pageY);a.shiftKey&&(b=g.getRightAngleLineLastPointCoords(this._coords,b)),this.addPoint(b.x,b.y)},g.prototype.onStopDrawing=function(a){("click"==a.type||"keydown"==a.type&&13==a.keyCode)&&g.testCoords(this._coords)&&(this.close(),i.removeAllEvents().setIsDraw(!1).resetNewArea().setMode("editing").setEditClass(),this.select()),a.stopPropagation(),a.preventDefault()},g.prototype.edit=function(a,b,c){var d=Object.create(this._coords);switch(a){case"move":for(var e=0,f=d.points.length;e<f;e++)d.points[e].x+=b,d.points[e].y+=c;break;case"movePoint":d.points[this.selected_point].x+=b,d.points[this.selected_point].y+=c}return d},g.prototype.onProcessEditing=function(a){var b=i.getEditType();this.redraw(this.edit(b,a.pageX-this.editingStartPoint.x,a.pageY-this.editingStartPoint.y)),this.editingStartPoint.x=a.pageX,this.editingStartPoint.y=a.pageY},g.prototype.onStopEditing=function(a){var b=i.getEditType();this.setCoords(this.edit(b,a.pageX-this.editingStartPoint.x,a.pageY-this.editingStartPoint.y)).redraw(),i.removeAllEvents(),i.update()},g.prototype.toString=function(){return"Polygon {points: ["+this._coords.points.map(function(a){return"["+a.x+", "+a.y+"]"}).join(", ")+"]}"},g.prototype.toHTMLMapElementString=function(){return'<area shape="poly" coords="'+this._coords.points.map(function(a){return a.x+", "+a.y}).join(", ")+'"'+(this._attributes.href?' href="'+this._attributes.href+'"':"")+(this._attributes.alt?' alt="'+this._attributes.alt+'"':"")+(this._attributes.title?' title="'+this._attributes.title+'"':"")+" />"},g.prototype.getCoordsForDisplayingInfo=function(){return{x:this._coords.points[0].x,y:this._coords.points[0].y}},g.testCoords=function(a){return a.points.length>=3},g.testHTMLCoords=function(a){return a.length>=6&&a.length%2==0},g.getCoordsFromHTMLArray=function(a){if(!g.testHTMLCoords(a))throw new Error("This html-coordinates is not valid for polygon");for(var b=[],c=0,d=a.length/2;c<d;c++)b.push({x:a[2*c],y:a[2*c+1]});return{points:b}},g.getRightAngleLineLastPointCoords=function(a,b){var c={DEG_22:.414,DEG_67:2.414},d=a.points.length-1,e=a.points[d],f=b.x-e.x,g=-(b.y-e.y),h=g/f,i=b.x,j=b.y;return f>0&&g>0?h>c.DEG_67?i=e.x:h<c.DEG_22?j=e.y:Math.abs(f)>Math.abs(g)?i=e.x+g:j=e.y-f:f<0&&g>0?h<-c.DEG_67?i=e.x:h>-c.DEG_22?j=e.y:Math.abs(f)>Math.abs(g)?i=e.x-g:j=e.y+f:f<0&&g<0?h>c.DEG_67?i=e.x:h<c.DEG_22?j=e.y:Math.abs(f)>Math.abs(g)?i=e.x+g:j=e.y-f:f>0&&g<0&&(h<-c.DEG_67?i=e.x:h>-c.DEG_22?j=e.y:Math.abs(f)>Math.abs(g)?i=e.x-g:j=e.y+f),{x:i,y:j}},g.createAndStartDrawing=function(a){var b=new g({points:[a],isOpened:!0});return i.addEvent(i.domElements.container,"mousemove",b.onProcessDrawing.bind(b)).addEvent(i.domElements.container,"click",b.onAddPointDrawing.bind(b)).addEvent(document,"keydown",b.onStopDrawing.bind(b)).addEvent(b._helpers.points[0]._el,"click",b.onStopDrawing.bind(b)),b};var j=function(){function b(){(n=i.getSelectedArea())&&(m.off("change keyup",b),n.setInfoAttributes({link:e.val(),asset:h.val(),page:k.val(),alt:l.val(),target:f.val()}),m.on("change keyup",b),i.update())}function c(c){void 0===f&&(e=a("#imagemap_link"),f=a("#imagemap_link_target"),g=a("#imagemap_link_asset"),h=g.next().find(".chosen-hidden-field"),j=a("#imagemap_link_page"),k=j.next().find(".chosen-hidden-field"),l=a("#imagemap_alt_text"),m=e.add(h).add(k).add(l).add(f)),c&&(m.off("change keyup",b),e.val(c._attributes.link),l.val(c._attributes.alt),f.val(c._attributes.target&&c._attributes.target.length?c._attributes.target:"_self"),c._attributes.asset&&c._attributes.asset.length?g.data("uberSelect").select(c._attributes.asset):g.data("uberSelect").results_reset(),c._attributes.page&&c._attributes.page.length?j.data("uberSelect").select(c._attributes.page):j.data("uberSelect").results_reset(),m.on("change keyup",b),o.show())}function d(){m.off("change keyup",b),o.hide()}var e,f,g,h,j,k,l,m,n,o=a("#fieldset-imagemap_areas");return{load:c,unload:d,save:b}}();a("#imageMapReload").on("click",function(b){var c="{{image:"+a(this).closest("form").serializeJSON()+":image}}";a.ajax({url:buildAjaxLink("assetManager.renderEmbeddedImageForEditor"),method:"POST",data:{embeddedImage:c},success:function(b){var c=a(b),d=c.is("img")?c:c.find("img"),e=d.attr("src");e&&e.length?i.loadImage(e):i.hide()},error:function(){i.hide()}}),b.preventDefault()}),a("#imageMapRemoveArea").on("click",function(a){a.preventDefault();i.getSelectedArea();i.removeObject(i.getSelectedArea()),i.setMode("editing").setEditClass().deselectAll()}),a(".imageMapAddArea").on("click",function(b){b.preventDefault();var c=a(this),d=c.data("shape");c.hasClass("active")?(i.setMode("editing").setEditClass().deselectAll(),c.siblings().andSelf().removeClass("active")):(i.setMode("drawing").setDrawClass().setShape(d).deselectAll(),c.addClass("active").siblings().removeClass("active"))}),a("[name^=imagemap_]","#fieldset-imagemap_areas").removeAttr("name")}(presideJQuery);
//# sourceMappingURL=_image-map.min.map